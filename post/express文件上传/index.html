<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.74.3" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Express文件上传 &middot; 阿泽的博客</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://liuzeaa.github.io/goblog/"><h1>阿泽的博客</h1></a>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://liuzeaa.github.io/goblog/">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2020. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Express文件上传</h1>
  <time datetime=2018-05-04T15:58:58Z class="post-date">Fri, May 4, 2018</time>
  <p>在后台项目中会经常碰见文件上传这个需求，例如用户上传一张头像等。。。今天就用Multer这个中间件来解决文件上传。</p>
<h2 id="安装multer">安装Multer</h2>
<p>第一步先安装Multer到你的项目里。</p>
<pre><code>npm install --save multer
</code></pre><h2 id="创建一个form表单">创建一个form表单</h2>
<p>这里就不用ajax去上传了。</p>
<pre><code>// index.html
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action=&quot;http://localhost:8000&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
        &lt;input type=&quot;file&quot; name=&quot;image&quot; /&gt;
        &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h2 id="form表单enctype属性">form表单enctype属性</h2>
<table>
<thead>
<tr>
<th align="center">值</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">application/x-www-form-urlencoded</td>
<td align="center">在发送前编码所有字符（默认）</td>
</tr>
<tr>
<td align="center">multipart/form-data</td>
<td align="center">不对字符编码。在使用包含文件上传控件的表单时，必须使用该值。</td>
</tr>
<tr>
<td align="center">text/plain</td>
<td align="center">空格转换为 &ldquo;+&rdquo; 加号，但不对特殊字符编码。</td>
</tr>
</tbody>
</table>
<h2 id="引用配置multer">引用配置multer</h2>
<pre><code>// app.js
const express = require('express');
const multer = require('multer');
const fs = require('fs');
const path = require('path');
const uploda = multer({
    dest: './uploads/' // 服务接收文件的路径
});

let app = express();

app.use(uploda.any()); // multer放到express中间件里

app.post('/', (req, res) =&gt; {
    console.log(req.files); // req.files接收到的文件信息一个数组
    // 添加后缀名，只支持一个文件上加后缀名，多文件改成递归
    let newName = req.files[0].path + path.extname(req.files[0].originalname);
    console.log(newName, req.files[0].path);
    fs.rename(req.files[0].path, newName, (err) =&gt; {
        if(err){
            console.log(err);
            res.sendStatus(500).send('error');
        }else{
            res.send('OK，上传成功。');
        }
        
    });
});

app.listen(8000);
</code></pre><p>在cmd执行 node app.js 打开index.html 选择文件上传，服务端就可以成功接收文件了。
multer 还有一些别的方法和参数，可自行去github查看。</p>
<h1 id="参考">参考</h1>
<p><a href="https://github.com/expressjs/multer">https://github.com/expressjs/multer</a></p>
</div>


    </main>

    
      
    
  </body>
</html>
