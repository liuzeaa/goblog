<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.74.3" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Hexo博客从Coding迁移到腾讯云COS &middot; 阿泽的博客</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://liuzeaa.github.io/goblog/"><h1>阿泽的博客</h1></a>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://liuzeaa.github.io/goblog/">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2020. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Hexo博客从Coding迁移到腾讯云COS</h1>
  <time datetime=2019-03-30T17:34:07Z class="post-date">Sat, Mar 30, 2019</time>
  <p>最近coding的Pages 服务一直不稳定，这两天访问还出现404，重新部署也无法解决。国内访问GitHub Pages  不是很快，而且百度SEO也爬不到。码云自定义域名收费，只好迁移到腾讯云COS上了。</p>
<!-- raw HTML omitted -->
<h2 id="创建存储桶">创建存储桶</h2>
<p><a href="https://console.cloud.tencent.com/cos5/bucket">https://console.cloud.tencent.com/cos5/bucket</a> 首先要创建存储桶。区域看各自情况任选，访问权限必须要选择公有读私有写。
<img src="https://hexo-1252491761.cos.ap-beijing.myqcloud.com/Hexo%E8%BF%81%E7%A7%BB/1.png" alt=""></p>
<h3 id="在基础设置开启静态网站">在<code>基础设置</code>开启静态网站</h3>
<p><img src="https://hexo-1252491761.cos.ap-beijing.myqcloud.com/Hexo%E8%BF%81%E7%A7%BB/2.png" alt="">
索引文档一定要填index.html，错误文档就看自定义的是什么文件了。</p>
<h3 id="在域名管理开启自定义加速域名cdn加速">在<code>域名管理</code>开启自定义加速域名（CDN加速）</h3>
<p><img src="https://hexo-1252491761.cos.ap-beijing.myqcloud.com/Hexo%E8%BF%81%E7%A7%BB/3.png" alt="">
填写上自己的域名就可以了。</p>
<h3 id="域名解析">域名解析</h3>
<p>在域名解析这里添加上刚才配置的自定义加速域名的CNAME地址。
<img src="https://hexo-1252491761.cos.ap-beijing.myqcloud.com/Hexo%E8%BF%81%E7%A7%BB/4.png" alt=""></p>
<h2 id="安装发布cos插件">安装发布COS插件</h2>
<pre><code>npm install hexo-deployer-cos-enhanced-dev --save
</code></pre><h3 id="配置_configyml">配置_config.yml</h3>
<p>把之前deploy的配置替换掉</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">deploy</span>: 
  <span style="color:#66d9ef">type</span>: cos
  <span style="color:#66d9ef">bucket</span>: blog<span style="color:#ae81ff">-1251123456</span>
  <span style="color:#66d9ef">region</span>: ap-shanghai
  <span style="color:#66d9ef">secretId</span>: AKIDIgxxxxxxxxxxxxxxxxxxxx0SepjX
  <span style="color:#66d9ef">secretKey</span>: qXPCbxxxxxxxxxxxxxxxxxxxxsJZfdR
    <span style="color:#66d9ef">cdnConfig</span>:
      <span style="color:#66d9ef">enable</span>: <span style="color:#66d9ef">true</span>
      <span style="color:#66d9ef">cdnUrl</span>: http://yourCdnSite.com
      <span style="color:#66d9ef">bucket</span>: static<span style="color:#ae81ff">-1251123456</span>
      <span style="color:#66d9ef">region</span>: ap-shanghai
      <span style="color:#66d9ef">folder</span>: static<span style="color:#ae81ff">-1251123456</span>
      <span style="color:#66d9ef">secretId</span>: AKIDIgxxxxxxxxxxxxxxxxxxxx0SepjX
      <span style="color:#66d9ef">secretKey</span>: qXPCbxxxxxxxxxxxxxxxxxxxxsJZfdR
</code></pre></div><p><code>secretId</code>  <code>secretKey</code> 包括cdnConfig下面这两个字段都可以不用填写， 直接从环境变量取</p>
<p><code>type</code>： 是固定死的，只能是 cos。</p>
<p><code>cdnUrl</code>： 是你的对象存储绑定的CDN域名，没有启用 CDN的话，推荐使用 <a href="https://github.com/sdlzhd/hexo-deployer-cos">https://github.com/sdlzhd/hexo-deployer-cos</a></p>
<p><code>bucket</code> 和 <code>region</code>： 在腾讯云的对象存储中，新建或找到你的 bucket，然后找到 <strong>默认域名</strong> 信息，会看到一个类似这样的域名: <code>blog-1251123456.cos.ap-shanghai.myqcloud.com</code>，第一个点前面的 <code>blog-1251123456</code> 就是 <code>bucket</code> 名称，第二个点和第三个点之间的 <code>ap-shanghai</code>，就是你的 COS 所在地域，填写到 <code>region</code> 中。</p>
<p><code>secretId</code> 和 <code>secretKey</code>：在 COS控制台中，找到左侧的<strong>密钥管理</strong>，点进去，按照提示添加子账号，并设置秘钥。同时要给子账号赋予 COS相关的权限，还有CDN刷新的权限。不会配置的可以参考 <a href="https://cloud.tencent.com/document/product/228/14867">官方示例</a></p>
<pre><code>hexo d
</code></pre><p>直接就发布到腾讯云COS上了，访问速度相当快，对SEO也好。</p>
<h2 id="添加持续集成自动发布到costravis-ci">添加持续集成自动发布到COS（Travis CI）</h2>
<p>我的博客使用Travis CI，而且备份也是在GitHub公开仓库， <code>secretId</code>  <code>secretKey</code>  这两个字段我只能写到Travis CI环境变量里面。</p>
<pre><code>script 
- hexo d
env:
 global:
   - SecretId: ${SecretId}
   - SecretKey: ${SecretKey}
</code></pre><p>只需要在.travis.yml 文件 script 下面加 hexo d 全局变量增加SecretId和SecretKey 这两个变量。
<img src="https://hexo-1252491761.cos.ap-beijing.myqcloud.com/Hexo%E8%BF%81%E7%A7%BB/5.png" alt=""></p>

</div>


    </main>

    
      
    
  </body>
</html>
