<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.74.3" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>给项目加一个骨架屏吧 &middot; 阿泽的博客</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://liuzeaa.github.io/goblog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://liuzeaa.github.io/goblog/"><h1>阿泽的博客</h1></a>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://liuzeaa.github.io/goblog/">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2020. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>给项目加一个骨架屏吧</h1>
  <time datetime=2019-04-27T16:07:19Z class="post-date">Sat, Apr 27, 2019</time>
  <p>骨架屏可以理解为是当数据还未加载进来前，页面的一个空白版本，一个简单的关键渲染路径。用户会看到一个样式简单，描绘了当前页面的大致框架的骨架屏页面，然后骨架屏中各个占位部分被实际资源完全替换，这个过程中用户会觉得内容正在逐渐加载即将呈现，降低了用户的焦躁情绪，使得加载过程主观上变得流畅。</p>
<h2 id="安装">安装</h2>
<p>这里采用饿了么开源的方案page-skeleton-webpack-plugin。</p>
<pre><code>npm install --save-dev page-skeleton-webpack-plugin
npm install --save-dev html-webpack-plugin
</code></pre><p>安装过程中报错提示如下</p>
<pre><code>ERROR: Failed to download Chromium r515411! Set &quot;PUPPETEER_SKIP_CHROMIUM_DOWNLOA
D&quot; env variable to skip download.
</code></pre><p>执行这个命令</p>
<pre><code>npm config set puppeteer_download_host=https://storage.googleapis.com.cnpmjs.org
</code></pre><h2 id="使用">使用</h2>
<p>我这个项目是基于<code>vue-cli3</code>脚手架开发的。</p>
<h3 id="第一步配置插件">第一步配置插件</h3>
<p>创建一个<code>vue.config.js</code>文件。</p>
<pre><code>const { SkeletonPlugin } = require('page-skeleton-webpack-plugin')
const path = require('path')

module.exports = {
  configureWebpack: {
    plugins: [
      new SkeletonPlugin({
        pathname: path.resolve(__dirname, './shell'), // 用来存储 shell 文件的地址
        staticDir: path.resolve(__dirname, './dist'), // 最好和 `output.path` 相同
        routes: ['/'], // 将需要生成骨架屏的路由添加到数组中
        excludes: ['.van-nav-bar', '.van-tabbar']  // 需要忽略的css选择器
      })
    ],
  },
  chainWebpack: (config) =&gt; {   // 解决vue-cli3脚手架创建的项目压缩html 干掉&lt;!-- shell --&gt;导致骨架屏不生效
    if (process.env.NODE_ENV !== 'development') {
      config.plugin('html').tap(opts =&gt; {
        opts[0].minify.removeComments = false
        return opts
      })
    }
    
  },
};
</code></pre><p>在项目根目录下面创建一个<code>shell</code>文件夹。
chainWebpack配置 这个是解决<code>vue-cli3</code>打包的骨架屏不生效的BUG</p>
<h3 id="第二步修改-html-webpack-plugin-插件的模板">第二步修改 HTML Webpack Plugin 插件的模板</h3>
<p>在你启动 App 的根元素内部添加 <!-- raw HTML omitted --></p>
<pre><code>&lt;body&gt;
  &lt;div id=&quot;app&quot;&gt;&lt;!-- shell --&gt;&lt;/div&gt;
  &lt;!-- built files will be auto injected --&gt;
&lt;/body&gt;
</code></pre><h3 id="第三步界面操作生成写入骨架页面">第三步：界面操作生成、写入骨架页面</h3>
<ul>
<li>
<p>在开发页面中通过 Ctrl|Cmd + enter 呼出插件交互界面，或者在在浏览器的 JavaScript 控制台内输入toggleBar 呼出交互界面。
<img src="https://hexo-1252491761.cos.ap-beijing.myqcloud.com/%E7%BB%99%E9%A1%B9%E7%9B%AE%E5%8A%A0%E4%B8%80%E4%B8%AA%E9%AA%A8%E6%9E%B6%E5%B1%8F%E5%90%A7/1.png" alt=""></p>
</li>
<li>
<p>点击交互界面中的按钮，进行骨架页面的预览，这一过程可能会花费 20s 左右时间，当插件准备好骨架页面后，会自动通过浏览器打开预览页面</p>
</li>
<li>
<p>扫描预览页面中的二维码，可在手机端预览骨架页面，可以在预览页面直接编辑源码，通过点击右上角写入按钮，将骨架页面写入到 shell 文件夹中。
<img src="https://hexo-1252491761.cos.ap-beijing.myqcloud.com/%E7%BB%99%E9%A1%B9%E7%9B%AE%E5%8A%A0%E4%B8%80%E4%B8%AA%E9%AA%A8%E6%9E%B6%E5%B1%8F%E5%90%A7/2.png" alt=""></p>
</li>
<li>
<p>通过 webpack 重新打包应用，当页面重新启动后，就能够在获取到数据前看到应用的骨架结构了。</p>
</li>
</ul>
<h2 id="最终效果">最终效果</h2>
<p><img src="https://hexo-1252491761.cos.ap-beijing.myqcloud.com/%E7%BB%99%E9%A1%B9%E7%9B%AE%E5%8A%A0%E4%B8%80%E4%B8%AA%E9%AA%A8%E6%9E%B6%E5%B1%8F%E5%90%A7/3.png" alt=""></p>
<h1 id="参考">参考</h1>
<p><a href="https://github.com/cnpm/cnpmjs.org/issues/1246">https://github.com/cnpm/cnpmjs.org/issues/1246</a>
<a href="https://github.com/ElemeFE/page-skeleton-webpack-plugin">https://github.com/ElemeFE/page-skeleton-webpack-plugin</a></p>
</div>


    </main>

    
      
    
  </body>
</html>
